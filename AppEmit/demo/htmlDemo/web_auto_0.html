<!DOCTYPE html>  <!--  manifest="/websocket.appcache"-->
<html >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title> AppEmit</title>
	 <meta name="description" content="轻量级中间件">
	 <meta name="keywords" content=" Embed App,websocket,SSL,RTSP,plugins,flash,mp4,flv,swf, m3u8,rtmp,mp3,aac">
    <!-- <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script> -->
    <style type="text/css">
      .Appboxs {
         margin-top:10px;
         justify-content:space-around;
         display: -webkit-box;
         display: -moz-box;
         display: -ms-flexbox;
         display: -webkit-flex;
         display: flex;
         display: box;
         display: flexbox;
      }
    </style>
</head>


<!--<script type="text/javascript" src="https://cdn.bootcss.com/pako/1.0.11/pako.min.js"></script>    如果使用Gzip压缩解压数据，则需要引入-->
<script src="./AppEmit_1.2_min.js" charset="utf-8"></script>
 
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/firebug-lite/1.4.0/firebug-lite.js#startOpened"></script> 
<script src="https://cdn.jsdelivr.net/gh/appemit/AppEmitWeb@master/docs/firebug_1.4.js#startOpened"></script> -->
<script type="text/javascript">
   function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
   }
</script>
<script>
   var fileId = GetQueryString("file");
   var noteId = GetQueryString("noteId");
   //传递cookie
   var allCookie = "c=44444"  ;//document.cookie;
   console.log("----------------------")
   console.log(allCookie)     //确保 这个地方和webpdf请求的里面所有的都一致
   var close_App = function(){
      AE.OpenApp( {"emit":"close","Obj":"web","AppId":1});
   }
	var init_App = function(){
      window.focus();
      AE.callbackFunc= {"equ": { "service":AE.service, "rid": 0,"clientAuth":1,"rep": 0},"func":input_App}
      AE.InitApp("wss://local.appemit.com:443/appemit?cid=00000-1&sid=1&flag=1")
	}

	 var htmlStr=AE.txt2code(function(){/*!@preserve
<html>
 <head>
			   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		 </head>	
 <body>		 
			 <div>
				 测试。测试测试测试测试测试测试
  
			  <input type="button" id="btn1" name="btn1" value="手动调用"  onclick="jsFun_a('测试')"></input>
		        <input type="button" id="btn2  name="btn2" value="主动反馈数据"  onclick="emitBack()"></input>
				</div>
				    <script>
					//JSON2兼容IE10
	     if(typeof JSON!=="object"){JSON={}}(function(){"use strict";var rx_one=/^[\],:{}\s]*$/;var rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rx_four=/(?:^|:|,)(?:\s*\[)+/g;var rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return(n<10)?"0"+n:n}function this_value(){return this.valueOf()}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?(this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"):null};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value}var gap;var indent;var meta;var rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?"\""+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+string+"\""}function str(key,holder){var i;var k;var v;var length;var mind=gap;var partial;var value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return(isFinite(value))?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?("[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]"):"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+((gap)?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+((gap)?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\"":"\\\"","\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k;var v;var value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return("\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4))})}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return(typeof reviver==="function")?walk({"":j},""):j}throw new SyntaxError("JSON.parse");}}}());
	
 
	  function emitBack(){
	   
	      external.emitBack(JSON.stringify({"AppMark":"mark2","rid":"rid1","a":56,"b":"sdfsd"}))
	   
	  }
	  
     // var  myAppJsFun=external.AppJsFun;  //wekit或者blink可以不要"external."
	   
	 var jsFun_a=function(a){ alert(a+123); }
	 
	 //这样注释转多行字符串的形式不支持script，需要修改。 即在运行代码前所有的script前的< \ /被替换为< /
    <\/script>
 
 
 </body>	
 </html>
 			
*/});
			
			
	var input_App = function(){
      var ReqPar=[
      {"emit":"open","Obj":"web","AppType":1,"AppId":1,"pos":1,"par":{"noRefresh":1,   // 测试这个文本可以不刷新
	  "htmlStr":htmlStr,"HttpServer_startUrl":null,
      //"URL": front_ip + "/static/templates/WebPDF_G2.html?file=" + fileId + "&noteId="+noteId
	  }, 
     "par0":{"userAgent":navigator.userAgent,"header": {"Cookie":allCookie}}    
	  }  //, "HOST":"...." 看一下是否需要，还有别的字段一样确定一下
    ,{"emit": "runCmd", "Obj": "web", "AppId": 1, "codeStr": ' return {userAgent:AppJsObject.web.script.navigator.userAgent,header:AppJsObject.web.addHeaders}' }
	  ,{"emit": "runCmd", "Obj": "web", "AppId": 1, "codeStr": 'AppJsObject.web.document.cookie="'+allCookie+'"; return AppJsObject.web.document.cookie;' }
	  // ,{"emit": "runCmd", "Obj": "web", "AppId": 1, "codeStr": 'AppJsFun.inet.clearCookie();/*清空了所有cookie刚刚增加的函数老版本没有*/ return AppJsObject.web.document.cookie;' }
      ,{"emit": "runCmd", "Obj": "web", "AppId": 1, "codeStr": 'AppJsObject.web.doScript("emitBack()")' }
   ];
      AE.OpenApp(ReqPar);
	}
	init_App();

</script>
 
<body>
   <!--   <h1>请使用支持文件异步上传的支持HTML5的浏览器</h1>  -->
   <div style="z-index: 999999">
      <div id="AppEmbed1"  style="border: solid 2px #F0F0F0; min-width:30px;min-height:20px;width:100%;height:1200px;" >
         <!-- <button onclick="testCookie()">反馈cookie</button>  -->
      </div>
   </div>
</body>

</html>
